# Network Monitor Agent Configuration

# AI Provider Settings
ai:
  provider: "ollama"  # Using local Ollama
  model: "linuxexpert:latest"  # Specialized for Linux system administration
  # Alternative models if this is too slow:
  # model: "linux-helper-hermes:latest"  # Faster, 4.7GB
  # model: "qwen2.5:14b"  # Excellent reasoning, 9.0GB

# Monitoring Settings
monitoring:
  interval: 60  # Check every 60 seconds

  # System Monitoring
  system:
    enabled: true
    cpu_threshold: 80  # Alert if CPU > 80%
    memory_threshold: 85  # Alert if memory > 85%
    disk_threshold: 90  # Alert if disk > 90%
    check_services:
      - docker
      - ssh
      # - nginx  # Add services you want to monitor

    check_mounts:  # Mounts to monitor
      - path: /mnt/PersonalOS
        source: "192.168.1.234:/mnt/user/PersonalOS"
        type: nfs4
        options: "defaults,_netdev"
      - path: /mnt/nas-ai
        source: "192.168.1.234:/mnt/user/AIserver"
        type: nfs4
        options: "defaults,_netdev"
      - path: /mnt/nas/Scans
        source: "192.168.1.234:/mnt/user/Scans"
        type: nfs4
        options: "defaults,_netdev"
      - path: /mnt/unraid/STLs
        source: "192.168.1.234:/mnt/user/STLs"
        type: nfs4
        options: "defaults,_netdev"
      - path: /mnt/nas/Movies
        source: "192.168.1.234:/mnt/user/Movies"
        type: nfs4
        options: "defaults,_netdev"

  # Network Monitoring
  network:
    enabled: true
    hosts_to_ping:
      - 8.8.8.8  # Google DNS
      - 1.1.1.1  # Cloudflare DNS
    packet_loss_threshold: 10  # Alert if > 10% packet loss
    latency_threshold: 200  # Alert if latency > 200ms
    ignore_interfaces:  # Interfaces to skip monitoring
      - enp10s0
      - enp7s0d1
      - tailscale0

  # Web Service Monitoring
  web_services:
    enabled: true
    endpoints:
      # AI Services (Local - AIserver)
      - url: "http://localhost:3001"
        name: "Open WebUI"
        timeout: 5
        expected_status: 200
      - url: "http://localhost:11434/api/tags"
        name: "Ollama API"
        timeout: 5
        expected_status: 200
      - url: "http://localhost:8001"
        name: "Paperless"
        timeout: 5
        expected_status: 200
      - url: "http://localhost:9999"
        name: "SearXNG"
        timeout: 5
        expected_status: 200

      # Home Assistant
      - url: "http://192.168.1.101:8123"
        name: "Home Assistant"
        timeout: 5
        expected_status: 200

      # Media Services
      - url: "http://192.168.1.163:8096"
        name: "Jellyfin"
        timeout: 5
        expected_status: 200
      - url: "http://192.168.1.57:5000"
        name: "Frigate NVR"
        timeout: 5
        expected_status: 200

      # Proxmox Web Interfaces
      - url: "https://192.168.1.98:8006"
        name: "Proxmox Media Stack"
        timeout: 5
        expected_status: 200
      - url: "https://192.168.1.163:8006"
        name: "Proxmox Jellyfin"
        timeout: 5
        expected_status: 200

      # Unraid
      - url: "http://192.168.1.234"
        name: "Unraid WebUI"
        timeout: 5
        expected_status: 200

  # Remote Server Monitoring (SSH-based)
  remote_servers:
    enabled: true
    servers:
      - name: "prx-mdastck-svr"
        host: "192.168.1.98"
        user: "root"
      - name: "prx-jelfrig-srv"
        host: "192.168.1.163"
        user: "root"
      - name: "SideNas-Unraid"
        host: "192.168.1.234"
        user: "root"

  # Proxmox Monitoring (API-based)
  proxmox:
    enabled: true
    hosts:
      - name: "prx-mdastck-svr"
        host: "192.168.1.98"
        node: "pve"
        username: "root@pam"
        password: "${PROXMOX_PASSWORD}"  # Set via environment
      - name: "prx-jelfrig-srv"
        host: "192.168.1.163"
        node: "pve"
        username: "root@pam"
        password: "${PROXMOX_PASSWORD}"

  # Docker Remote Monitoring
  docker_remote:
    enabled: true
    hosts:
      - name: "Unraid"
        host: "192.168.1.234"
        user: "root"

  # Home Assistant Monitoring
  home_assistant:
    enabled: true
    instances:
      - name: "Home Assistant"
        url: "http://192.168.1.101:8123"
        token: "${HA_TOKEN}"
        check_automations: true
        check_entities: true
        check_integrations: true
        # Only monitor specific domains to reduce noise
        entity_domains:
          - light
          - switch
          - climate
          - binary_sensor
          - sensor
          - lock
          - cover

# Remediation Settings
remediation:
  auto_fix: true
  max_attempts: 3
  cooldown: 300  # Wait 5 minutes before retrying same fix

  # Actions the agent can take automatically
  allowed_actions:
    - restart_service
    - clear_cache
    - kill_hung_process
    - restart_container
    - clear_disk_space
    - remount  # Remount stale mounts
    - unmount_remount  # Full unmount/remount for failed mounts
    - enable_automation  # Re-enable disabled Home Assistant automations
    - reload_integration  # Reload failed Home Assistant integrations

# Notification Settings
notifications:
  log_file: "/var/log/network-monitor-agent.log"
  log_level: "INFO"

  discord:
    enabled: true
    webhook_url: "${DISCORD_WEBHOOK_URL}"
    notify_on:
      - actions_taken    # When agent fixes something
      - critical_issues  # High/critical severity only
      - daily_summary    # Once per day health report

  slack:
    enabled: false
    webhook_url: "${SLACK_WEBHOOK_URL}"
